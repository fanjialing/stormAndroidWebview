var paperResultId=Number(getQueryString("paperResultId")==null?"-1":getQueryString("paperResultId"));var paperId=Number(getQueryString("paperId")==null?"":getQueryString("paperId"));var employeeId=getQueryString("employeeId")==null?"":getQueryString("employeeId");var CompanyId=getQueryString("CompanyId")==null?"":getQueryString("CompanyId");var isAnswer=getQueryString("a")==1?true:false;var isAnswerPage=true;var q_index=0;var q_count=2;var q_time=10;var q_index_id="#txt_q_index";var setTimeInterval=null;var qList=[];var resultList;var resultList2=[];var isCheckBox=true;var isMark=0;var onResult=null;var onResultIndex=0;var markOk="#q_markOk";var markCancel="#q_markCancel";var Name=getQueryString("Name")==null?"":getQueryString("Name");var Company=getQueryString("Company")==null?"":getQueryString("Company");var loginStatus=Number(getQueryString("loginStatus")==null?"0":getQueryString("loginStatus"));var loginUrl="?loginStatus="+loginStatus+"&CompanyId="+CompanyId+"&employeeId="+employeeId+"&Name="+Name+"&Company="+Company;var parAllNoId="?loginStatus="+loginStatus+"&CompanyId="+CompanyId+"&employeeId="+employeeId+"&Name="+Name+"&Company="+Company+"&paperId="+paperId;var parAll=parAllNoId+"&paperResultId="+paperResultId;$(function(){if(employeeId==""||Name==""||Company==""){confirm_dialog("#confirm","温馨提示","请登记考试信息或者登陆!","","<a href=index.html>确定</a>")}ajaxSubmit("papers/"+paperId+"?excludeItems=false",{},"get",function(b){qList=b.items;q_count=qList.length;resultList=new Array(q_count);q_time=b.timeLimit*60;q_index=0;$("#txt_q_count").html(q_count);$("#title").html(b.title);if(qList==0){confirm_dialog("#confirm","温馨提示","试卷信息错误，请重新加载...","","<a href=index.html"+loginUrl+">确定</a>")}initPage();timer(q_time);setNewQuestion(qList[q_index],q_index);setContentClick();initBadge(q_index);setBadge();setButton(q_index,q_count-1);$("#prev").click(function(){if(q_index==0){return}submitAnswer(q_index);q_index--;$("#txt_q_index").text(q_index+1);setNewQuestion(qList[q_index],q_index);setButton(q_index,q_count-1);setContentClick();getResult(q_index);initBadge(q_index)});$("#next").click(function(){if(q_index==q_count-1){return}submitAnswer(q_index);q_index++;$("#txt_q_index").text(q_index+1);setNewQuestion(qList[q_index],q_index);setButton(q_index,q_count-1);setContentClick();getResult(q_index);initBadge(q_index)})});$("#exit").click(function(){if(isAnswer){$("#jiaojuan").click()}else{confirm_dialog("#confirm","温馨提示","是否确认退出查看试卷？","取消","<a href=#>确定</a>",function(b){if(b){window.location.href="channel.html"+parAll}})}});$("#dtk_but").click(function(){disable_scroll();$("html,body").css("overflow","hidden");$("html,body").css("height","100%");$("#mask").show();$("#dtklist").on("touchmove",function(b){b.stopPropagation()});initAnswerPage(q_index);if(isAnswer){$("#dtklist li").each(function(){var d=$(this).children("a").attr("value");var b=false;for(var c=0;c<resultList.length;c++){if(!resultList[c]){continue}b=false;var e=resultList[c].index;if(e==d){if(resultList[c].chose.length>0){b=true;$(this).removeClass();$(this).addClass("green")}if(resultList[c].ismark==1){$(this).children("div").removeClass();if(b){$(this).children("div").addClass("biaoji")}else{$(this).children("div").addClass("biaoji-grey")}}}}})}if(!isAnswer){$("#dtklist li").each(function(){var d=$(this).children("a").attr("value");var b=false;for(var c=0;c<resultList2.length;c++){b=false;if(c==d){if(resultList2[c].answer.length>0&&resultList2[c].answer!="0"){b=true;$(this).removeClass();$(this).addClass("green");if(resultList2[c].score>0){$(this).children("div").addClass("right")}else{if(resultList2[c].answer.length>0&&resultList2[c].answer){$(this).removeClass("green");$(this).addClass("red");$(this).children("div").addClass("error")}}}if(resultList2[c].isMark==1){$(this).children("div").removeClass();if(b){$(this).children("div").addClass("biaoji")}else{$(this).children("div").addClass("biaoji-grey")}}}}})}a()});$("#close").click(function(){CloseDiv();$("html,body").css("overflow","auto");$("html,body").css("height","auto");$("#mask").hide()});function a(){$("#dtklist a").click(function(){q_index=parseInt($(this).attr("value"));$("#close").click();$("#txt_q_index").text(q_index+1);setNewQuestion(qList[q_index],q_index);setButton(q_index,q_count-1);setContentClick();getResult(q_index);initBadge(q_index)})}$("#jiaojuan").click(function(){var b=qList.length;if(resultList.length>0){for(var c=0;c<resultList.length;c++){if(resultList[c]){if(resultList[c].chose.length>=0){b--}}}}if(q_index==qList.length-1){submitAnswer(q_index)}var d="";if(b==0){d="是否确认提交答题卡？"}else{d="您还有"+b+"道题目未完成！是否确认提交答题卡？"}confirm_dialog("#confirm","温馨提示",d,"取消","<a href='javascript:void(0)'>确定</a>",function(f){if(f){var e=JSON.stringify({id:paperResultId});ajaxSubmit("paperresults/"+paperResultId,e,"post",function(g){window.location.href="end.html"+parAll})}})});if(!isAnswer){ajaxSubmit("paperresults/"+paperResultId+"?excludeItems=false",{},"get",function(b){resultList2=b.itemResults})}});function initPage(){if(isAnswer){$("#bj").css("display","inline-block");$("#timer").css("display","block")}}function initAnswerPage(b){if(qList.length==0){return}var c="";for(var a=0;a<qList.length;a++){if(a==b){c+='<li class="orange"><div class=""></div><a href="javascript:void(0)"  itemid='+qList[a].id+" value="+a+">"+(a+1)+"</a></li>"}else{c+='<li class="grey"><div></div><a href="javascript:void(0)" itemid='+qList[a].id+"  value="+a+">"+(a+1)+"</a></li>"}}$("#dtklist").html(c)}function setContentClick(){if(!isAnswer){for(var b=0;b<resultList2.length;b++){if(resultList2[b].itemId==qList[q_index].id){var d=qList[q_index].answer;var e=resultList2[b].answer;if(isCheckBox){d=d,split(",");for(var c=0;c<d.length;c++){$("#content li").each(function(){if($(this).attr("oid")==d[c]){$(this).addClass("right");$(this).children("div").addClass("right")}})}for(var g=0;g<e.length;g++){if($(this).attr("oid")==e[g]){if(!$(this).hasClass("right")){$(this).addClass("error");$(this).children("div").addClass("error")}}}e=e.split(",")}else{$("#content li").each(function(){if($(this).attr("oid")==d){$(this).addClass("right");$(this).children("div").addClass("right")}if(d!=e){if($(this).attr("oid")==e){$(this).addClass("error");$(this).children("div").addClass("error")}}})}var a="right";if(d!=e){a="error"}if(e=="0"){e=""}var f="<dd>参考答案为   <span class='right'>"+d+"</span></dd>";f+="<dd>我的答案为   <span class="+a+">"+e+"</span></dd>";$("#content").append(f)}}return}$("#content li").click(function(){if(isCheckBox){if($(this).hasClass("right")){$(this).addClass("right")}}else{$("#content li").each(function(){$(this).removeClass("right")});$(this).addClass("right")}setResult(q_index)})}function timer(a){a=a-1;if(!isAnswer){return}window.setInterval(function(){var b=0,c=0,d=0,e=0;if(a>0){b=Math.floor(a/(60*60*24));c=Math.floor(a/(60*60))-(b*24);d=Math.floor(a/60)-(b*24*60)-(c*60);e=Math.floor(a)-(b*24*60*60)-(c*60*60)-(d*60)}if(d<=9){d="0"+d}if(e<=9){e="0"+e}$("#hour_show").html('<s id="h"></s>'+c+"时");$("#minute_show").html("<s></s>"+d+"分");$("#second_show").html("<s></s>"+e+"秒");a--;if(a==0){$("#jiaojuan").click()}},1000)}function setNewQuestion(d,a){var f="";switch(d.itemType.toLowerCase()){case"radio":isCheckBox=false;f="单选题";break;case"checkbox":isCheckBox=true;f="多选题";break;case"YesOrNo":isCheckBox=false;f="判断题";break;default:isCheckBox=false;f="判断题";break}$("#titletype").text(f+" : ");$("#question").text(d.title);var c=d.itemOptions;var b="";var e="";if(c.length==0){items="<li>抱歉,该题未找到题项！请选择其它题！</li>"}$.each(c,function(h,g){e=String.fromCharCode(65+h);b+='<li oid="'+e+'" itemid='+g.id+">";b+="<div></div>";b+="<a >"+e+". "+g.content+"</a>";b+="</li>"});$("#content").html(b)}function setButton(b,a){$("#prev").addClass("enabled");$("#next").addClass("enabled");if(b==0){$("#prev").removeClass("enabled");$("#prev").addClass("disabled");$("#prev").attr("disabled","true")}if(b==a){$("#next").removeClass("enabled");$("#next").addClass("disabled");$("#next").attr("disabled","true")}if(isAnswer){$("#jiaojuan").css("display","block")}}function initBadge(a){if(!isAnswer){return}isMark=0;if(resultList[a]){isMark=resultList[a].ismark}if(isMark==1){$("#bj small").addClass("bj1");$("#bj small").removeClass("bj0");$("#bj span").text("取消标记")}else{$("#bj small").addClass("bj0");$("#bj small").removeClass("bj1");$("#bj span").text("标记该题")}}function setBadge(){if(!isAnswer){return}$("#bj").click(function(){isMark=(isMark==0?1:0);if(isMark==1){$("#bj small").addClass("bj1");$("#bj small").removeClass("bj0");$("#bj span").text("取消标记")}else{$("#bj small").addClass("bj0");$("#bj small").removeClass("bj1");$("#bj span").text("标记该题")}setResult(q_index)})}function setResult(b){var a="";$("#content li").each(function(){if($(this).hasClass("right")){a+=$(this).attr("oid")+","}});if(a.length>0){a=a.substring(0,a.length-1)}var c={index:b,chose:a,ismark:isMark};resultList[b]=c}function getResult(c){if(resultList.length==0){return}if(!resultList[c]){return}if(resultList[c].index==c){var a=resultList[c].chose;var b=a.split(",");for(var d=0;d<b.length;d++){$("#content li").each(function(){if($(this).attr("oid")==b[d]){$(this).addClass("right")}})}}}function submitAnswer(b){if(!isAnswer){return}if(!resultList[b]){return}var d=qList[b];var c=d.id;var a=resultList[b].chose;if(!a){a="0"}ajaxSubmit("itemresults/"+paperResultId+"/"+c+"/"+isMark+"/"+a,{},"put",function(e){})}function disable_scroll(){$("body").on("touchmove",prevent_default)}function ShowDiv(){window.ontouchmove=function(a){a.preventDefault&&a.preventDefault();a.returnValue=false;a.stopPropagation&&a.stopPropagation();return false}}function CloseDiv(){window.ontouchmove=function(a){a.preventDefault&&a.preventDefault();a.returnValue=true;a.stopPropagation&&a.stopPropagation();return true}}function prevent_default(a){a.preventDefault()};